<div class="dashboard-container">
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-overlay">
    <div class="loading-content">
      <div class="spinner"></div>
      <p>{{ 'LOADING_DASHBOARD' | translate }}</p>
    </div>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="user && !loading" class="dashboard-layout">
    <!-- Left Sidebar Navigation -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <h1 class="logo">
          <span class="logo-red">A</span><span class="logo-gray">LTEA</span>
        </h1>
      </div>

      <nav class="sidebar-nav">
        <button 
          class="nav-item"
          [class.active]="activeNav === 'dashboard'"
          (click)="navigateTo('dashboard')">
          <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
          </svg>
          <span>{{ 'DASHBOARD' | translate }}</span>
        </button>

        <button 
          class="nav-item"
          [class.active]="activeNav === 'employees'"
          (click)="navigateTo('employees')">
          <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
          </svg>
          <span>{{ 'NAV_EMPLOYEES' | translate }}</span>
        </button>

        <button 
          class="nav-item"
          [class.active]="activeNav === 'sites'"
          (click)="navigateTo('sites')">
          <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
          </svg>
          <span>{{ 'NAV_SITES' | translate }}</span>
        </button>

        <button 
          class="nav-item"
          [class.active]="activeNav === 'payments'"
          (click)="navigateTo('payments')">
          <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-12v12"/>
          </svg>
          <span>{{ 'NAV_PAYMENTS' | translate }}</span>
        </button>

        <button 
          class="nav-item"
          [class.active]="activeNav === 'materials'"
          (click)="navigateTo('materials')">
          <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
          </svg>
          <span>{{ 'NAV_MATERIALS' | translate }}</span>
        </button>
      </nav>

      <div class="sidebar-footer">
        <button class="logout-btn" (click)="onLogout()">
          <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
          </svg>
          <span>{{ 'LOGOUT' | translate }}</span>
        </button>
      </div>
    </aside>

    <!-- Main Content Area -->
    <div class="main-wrapper">
      <!-- Top Header -->
      <header class="top-header">
        <div class="header-content">
          <h2 class="page-title">{{ 'DASHBOARD' | translate }}</h2>
          
          <div class="header-actions">
            <button class="language-toggle" (click)="toggleLanguage()">
              {{ getCurrentLanguage() === 'en' ? 'MK' : 'EN' }}
            </button>

            <div class="user-info">
              <div class="user-details">
                <p class="user-name">{{ user.first_name }} {{ user.last_name }}</p>
                <p class="user-role">{{ user.role.role_name || ('EMPLOYEE' | translate) }}</p>
              </div>
              <div class="user-avatar">
                {{ (user.first_name || 'U').charAt(0) }}
              </div>
            </div>
          </div>
        </div>
      </header>

      <!-- Main Content -->
      <main class="main-content">
        <div class="welcome-section">
          <h1 class="welcome-title">
            {{ 'WELCOME_BACK' | translate }}, {{ user.first_name }}!
          </h1>
          <p class="welcome-message">
            {{ 'WELCOME_HRIMTHURSHUB_MESSAGE' | translate }}
          </p>
        </div>

        <div class="content-grid">
          <!-- Quick Overview -->
          <div class="card quick-overview-card">
            <div class="card-header">
              <h3>{{ 'QUICK_OVERVIEW' | translate }}</h3>
            </div>
            <div class="card-body">
              <div class="overview-grid">
                <div class="overview-item">
                  <div class="overview-icon employees">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path>
                    </svg>
                  </div>
                  <div class="overview-details">
                    <p class="overview-label">{{ 'TOTAL_EMPLOYEES' | translate }}</p>
                    <p class="overview-value">0</p>
                  </div>
                </div>

                <div class="overview-item">
                  <div class="overview-icon sites">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                    </svg>
                  </div>
                  <div class="overview-details">
                    <p class="overview-label">{{ 'ACTIVE_SITES' | translate }}</p>
                    <p class="overview-value">{{ activeSites.length }}</p>
                  </div>
                </div>

                <div class="overview-item">
                  <div class="overview-icon materials">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
                    </svg>
                  </div>
                  <div class="overview-details">
                    <p class="overview-label">{{ 'SITES_IN_PLANNING' | translate }}</p>
                    <p class="overview-value">{{ planningSites.length }}</p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Active Sites Cards -->
          <div class="card sites-cards-container">
            <div class="card-header">
              <h3>{{ 'SITES_OVERVIEW' | translate }}</h3>
              <button class="view-all-btn" (click)="navigateTo('sites')">
                <span>{{ 'VIEW_ALL_SITES' | translate }}</span>
              </button>
            </div>
            <div class="card-body sites-cards-body">
              <div class="sites-cards-grid">
                <div *ngFor="let site of getActivePlanningPreview()" class="site-card" [class]="'site-card-' + site.status">
                  <div class="site-card-header">
                    <div class="site-card-icon">{{ getSiteIcon(site.status) }}</div>
                    <div class="site-card-info">
                      <h4 class="site-card-name">{{ site.site_name }}</h4>
                      <p class="site-card-address">{{ site.address || ('NO_ADDRESS' | translate) }}</p>
                    </div>
                  </div>
                  <div class="site-card-stats">
                    <div class="stat-item">
                  
                      <span class="stat-value">{{ getSiteEmployeesCount(site) }}</span>
                      <span class="stat-label">{{ 'ACTIVE_TODAY' | translate }}</span>
                    </div>
                    <div class="stat-item">
                  
                      <span class="stat-value">${{ (site.money_spent || 0).toLocaleString() }}</span>
                      <span class="stat-label">{{ 'MONEY_SPENT' | translate }}</span>
                    </div>
                    <div class="stat-item">
                  
                      <span class="stat-value">{{ (site.materials?.length || 0) }}</span>
                      <span class="stat-label">{{ 'MATERIALS_LABEL' | translate }}</span>
                    </div>
                    <div class="stat-item" *ngIf="(site.warnings?.length || 0) > 0">
                    
                      <span class="stat-value warning">{{ site.warnings?.length }}</span>
                      <span class="stat-label">{{ 'WARNINGS' | translate }}</span>
                    </div>
                  </div>
                </div>
                <div *ngIf="sitesLoading" class="no-sites-message">
                  <p>{{ 'LOADING_SITES' | translate }}</p>
                </div>
                <div *ngIf="!sitesLoading && getActivePlanningPreview().length === 0" class="no-sites-message">
                  <p>{{ 'NO_ACTIVE_PLANNING_SITES' | translate }}</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Sites Map -->
          <div class="card sites-map-card">
            <div class="card-header">
              <h3>{{ 'SITES_LOCATION_OVERVIEW' | translate }}</h3>
              <div class="map-legend">
                <span class="legend-item">
                  <span class="legend-dot active"></span> {{ 'ACTIVE' | translate }} ({{ activeSites.length }})
                </span>
                <span class="legend-item">
                  <span class="legend-dot planning"></span> {{ 'STATUS_PLANNING' | translate }} ({{ planningSites.length }})
                </span>
              </div>
            </div>
            <div class="card-body map-body">
              <div id="dashboard-map" class="dashboard-map"></div>
            </div>
          </div>

          <!-- Separator Line -->
          <div class="section-separator"></div>

          <!-- Recent Activities -->
          <div class="card recent-activities-card">
            <div class="card-header">
              <h3>{{ 'RECENT_ACTIVITY' | translate }}</h3>
            </div>
            <div class="card-body">
              <div class="activities-list">
                <div class="activity-item">
                  <div class="activity-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                  </div>
                  <div class="activity-content">
                    <p class="activity-text">{{ 'SYSTEM_INITIALIZED' | translate }}</p>
                    <p class="activity-time">{{ 'JUST_NOW' | translate }}</p>
                  </div>
                </div>

                <div class="activity-item">
                  <div class="activity-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                  </div>
                  <div class="activity-content">
                    <p class="activity-text">{{ user.first_name }} {{ user.last_name }} {{ 'LOGGED_IN' | translate }}</p>
                    <p class="activity-time">{{ 'TODAY_LABEL' | translate }}</p>
                  </div>
                </div>

                <div class="activity-item">
                  <div class="activity-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                  </div>
                  <div class="activity-content">
                    <p class="activity-text">{{ 'WELCOME_TO_ALTEA' | translate }}</p>
                    <p class="activity-time">{{ 'TODAY_LABEL' | translate }}</p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Separator Line -->
          <div class="section-separator"></div>

          <!-- Newsletter -->
          <div class="card newsletter-card clickable" (click)="openNewsletter()">
            <div class="card-header">
              <h3>{{ 'NEWSLETTER' | translate }}</h3>
              <svg class="arrow-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
              </svg>
            </div>
            <div class="card-body">
              <div class="newsletter-content">
                <div class="newsletter-icon">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"></path>
                  </svg>
                </div>
                <div class="newsletter-text">
                  <p class="newsletter-title">{{ 'STAY_UPDATED' | translate }}</p>
                  <p class="newsletter-description">{{ 'CHECK_LATEST_NEWS' | translate }}</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Contact Support -->
          <div class="card newsletter-card clickable" (click)="openContactSupport()">
            <div class="card-header">
              <h3>{{ 'CONTACT_SUPPORT' | translate }}</h3>
              <svg class="arrow-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
              </svg>
            </div>
            <div class="card-body">
              <div class="newsletter-content">
                <div class="newsletter-icon">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"></path>
                  </svg>
                </div>
                <div class="newsletter-text">
                  <p class="newsletter-title">{{ 'NEED_HELP' | translate }}</p>
                  <p class="newsletter-description">{{ 'CONTACT_SUPPORT_HELP_TEXT' | translate }}</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- Contact Support Modal Component -->
  <app-contact-support></app-contact-support>
</div>
